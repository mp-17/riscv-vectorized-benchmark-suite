#!/bin/busybox sh

# Mount /proc early
mkdir -p /proc
mount -t proc proc /proc

# Mount /sys early
mkdir -p /sys
mount -t sysfs sysfs /sys

# Check if /dev is already mounted
if ! mountpoint -q /dev; then
    mount -t devtmpfs devtmpfs /dev
else
    echo "/dev is already mounted"
fi

# Remount the root filesystem as read-write
mount -o remount,rw /

# Make symlinks for all BusyBox commands
/bin/busybox --install -s

# Mount other filesystems
mount -t tmpfs tmpfs /tmp

# BusyBox TTY fix
setsid cttyhack sh

# Set up mdev for hotplugging
echo /sbin/mdev > /proc/sys/kernel/hotplug
mdev -s

# Drop to a shell
exec sh